# Chaos Engineering
 
Для удобства описания экспериментов по CE (Chaos Engineering) 
разметим цифрами (красным шрифтом) основные узлы тестируемой системы

![image](images/hld.png)


## Описание экспериментов

1. Отключение узла master узла patroni.
2. Отключение реплики узла patroni
3. Отключение узлов etcd
4. Отключение узла балансировки нагрузки с целью пронаблюдать как поведёт себя слой приложения.
5. 
6.
7.

## Подготовительные работы

### Установка инструмента CE
В качестве инструмента CE выбран [ChaosBlade](https://chaosblade.io/).


Установим на каждую ноду (1 - 6) ChaosBlade согласно документации
https://chaosblade.io/en/docs/getting-started/installation-and-deployment/tool-chaosblade-install-and-uninstall
выполнив на каждой из нод

```console
wget https://github.com/chaosblade-io/chaosblade/releases/download/v1.7.2/chaosblade-1.7.2-linux-amd64.tar.gz
tar -xvf chaosblade-1.7.2-linux-amd64.tar.gz && cd chaosblade-1.7.2/
```

### Подготовка нагрузки на БД

Т.к. наш стенд тренировочный и не используется никак в реальном времени, 
необходимо сымитировать запись или обновление в базу во время CE экспериментов с мастером и репликой PG-кластера.

Во время нагрузочного тестирования нагружалось только чтение, т.к. запись и обновление считались относительно редкими операциями, 
но воспользовавшись тем же инструментом (k6) можем написать вспомогательный скрипт для небольшой нагрузки записи в базу

https://github.com/alexandr-chumakov/mts-course-sre-ht/blob/master/scripts/forecast_post.js


| №  | Ожидание | Результат |
|----|----------|-----------|
| 1  |          |           |
| 2  |          |           |
| 3  |          |           |
| 4  |          |           |


